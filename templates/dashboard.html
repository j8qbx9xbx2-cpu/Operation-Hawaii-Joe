{% extends "base.html" %}
{% set title = "Dashboard" %}
{% block content %}
  <div class="relative overflow-hidden rounded-3xl border border-slate-800 bg-slate-950">
    <img src="{{ url_for('static', filename='images/hero.jpg') }}" alt="Hawaii" class="absolute inset-0 h-full w-full object-cover opacity-40" />
    <div class="absolute inset-0 bg-gradient-to-r from-slate-950/95 via-slate-950/40 to-slate-950/95"></div>
    <div class="relative p-5">
      <div class="text-2xl md:text-3xl font-semibold">Operation Hawaii</div>
      <div class="mt-1 text-sm md:text-base text-slate-200">Daily execution → 190 lbs with defined arms &amp; abs by June 1.</div>
      <div class="mt-4 flex flex-wrap gap-2">
        <a href="{{ url_for('day_view', dstr=today.isoformat()) }}" class="px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500 font-medium text-sm">Log Today</a>
        <a href="{{ url_for('meal_suggestions') }}" class="px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 font-medium text-sm">Meal Ideas</a>
        <a href="{{ url_for('reset_page') }}" class="px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 font-medium text-sm">2‑Week Reset</a>
      </div>
    </div>
  </div>
<div class="relative overflow-hidden rounded-3xl border border-slate-800 bg-slate-950 p-5 mb-4">
  <img src="{{ url_for('static', filename='images/hero.jpg') }}"
       class="absolute inset-0 h-full w-full object-cover opacity-25" alt="Hawaii" />
  <div class="absolute inset-0 bg-gradient-to-r from-slate-950/95 via-slate-950/50 to-slate-950/95"></div>

  <div class="relative">
    <div class="text-2xl font-semibold tracking-tight">Operation Hawaii</div>
    <div class="text-sm text-slate-300">Cut the weight. Earn the beach.</div>
  </div>
</div>

  <div class="mt-6 grid md:grid-cols-3 gap-4">
    <div class="rounded-2xl bg-slate-900 border border-slate-800 p-4">
      <div class="text-sm text-slate-400">Today</div>
      <div class="text-2xl font-semibold">{{ today.isoformat() }}</div>
      <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
        <div class="rounded-xl bg-slate-950 border border-slate-800 p-3">
          <div class="text-slate-400">Weight (AM)</div>
          <div class="text-lg font-semibold">{{ log.weight_am or "—" }}</div>
        </div>
        <div class="rounded-xl bg-slate-950 border border-slate-800 p-3">
          <div class="text-slate-400">Waist</div>
          <div class="text-lg font-semibold">{{ log.waist_in or "—" }}</div>
        </div>
      </div>
      <div class="mt-3 flex gap-2 text-sm">
        <span class="px-3 py-1 rounded-xl {{ 'bg-emerald-600' if log.walk_done else 'bg-slate-800' }}">Walk</span>
        <span class="px-3 py-1 rounded-xl {{ 'bg-emerald-600' if log.lift_done else 'bg-slate-800' }}">Lift</span>
        <span class="px-3 py-1 rounded-xl {{ 'bg-emerald-600' if log.if_done else 'bg-slate-800' }}">IF 11–7</span>
        <span class="px-3 py-1 rounded-xl {{ 'bg-emerald-600' if log.rings_closed else 'bg-slate-800' }}">Rings</span>
      </div>
      <div class="mt-3">
        <a href="{{ url_for('day_view', dstr=today.isoformat()) }}" class="inline-flex items-center justify-center w-full px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-sm font-medium">
          Open Today
        </a>
      </div>
    </div>

    <div class="rounded-2xl bg-slate-900 border border-slate-800 p-4 md:col-span-2">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm text-slate-400">Daily scoreboard</div>
          <div class="text-xl font-semibold">Compliance Score: <span class="{{ 'text-emerald-400' if score==4 else ('text-amber-300' if score==3 else 'text-rose-300') }}">{{ score }}/5</span></div>
        </div>
        <div class="text-sm text-slate-300">
          Targets: <span class="font-semibold">{{ log.cal_target }}</span> cals • <span class="font-semibold">{{ log.prot_target }}</span>g protein
        </div>
      </div>

      <div class="mt-4 rounded-2xl bg-slate-950 border border-slate-800 p-3">
        <div class="flex items-center justify-between text-sm">
          <div class="text-slate-400">On pace to {{ goal_date.strftime("%b %d, %Y") }}</div>
          <div class="font-medium">Pace: <span class="{{ 'text-emerald-400' if pace_pct>=100 else 'text-rose-300' }}">{{ pace_pct }}%</span></div>
        </div>
        <div class="mt-2 h-3 w-full rounded-full bg-slate-800 overflow-hidden">
          {% set pct = pace_pct if pace_pct < 140 else 140 %}
          <div class="h-3 rounded-full {{ 'bg-emerald-500' if pace_pct>=100 else 'bg-rose-500' }}" style="width: {{ pct }}%;"></div>
        </div>
        <div class="mt-2 text-xs text-slate-400">
          Start {{ start_weight }} → Goal {{ goal_weight }} • Expected today: {{ expected_weight }} • Current: {{ current_weight }}
        </div>
      </div>

      <div class="mt-4 grid sm:grid-cols-2 gap-3 text-sm">
        <div class="rounded-xl bg-slate-950 border border-slate-800 p-3">
          <div class="flex items-center justify-between">
            <div class="text-slate-400">Calories</div>
            <div class="{{ 'text-emerald-400' if cal_delta<=0 else 'text-rose-300' }}">{{ cal_delta }}</div>
          </div>
          <div class="text-2xl font-semibold mt-1">{{ log.calories_total or 0 }}</div>
          <div class="text-slate-500">Delta vs target</div>
        </div>
        <div class="rounded-xl bg-slate-950 border border-slate-800 p-3">
          <div class="flex items-center justify-between">
            <div class="text-slate-400">Protein</div>
            <div class="{{ 'text-emerald-400' if prot_delta>=0 else 'text-rose-300' }}">{{ prot_delta }}</div>
          </div>
          <div class="text-2xl font-semibold mt-1">{{ log.protein_g_total or 0 }}g</div>
          <div class="text-slate-500">Delta vs target</div>
        </div>
      </div>

      <div class="mt-5 grid md:grid-cols-2 gap-4">
        <div class="rounded-2xl bg-slate-950 border border-slate-800 p-3">
          <div class="text-sm text-slate-400 mb-2">Weight trend (last 30 days)</div>
          <canvas id="wchart"></canvas>
        </div>
        <div class="rounded-2xl bg-slate-950 border border-slate-800 p-3">
          <div class="text-sm text-slate-400 mb-2">Compliance (0–5)</div>
          <canvas id="cchart"></canvas>
        </div>
      </div>
    
    <div class="mt-4 flex flex-wrap gap-2">
      <div class="text-sm text-slate-400 w-full">Quick add templates</div>
      {% for q in quick_add %}
        <form method="post" action="{{ url_for('meal_quick_add') }}">
          <input type="hidden" name="day" value="{{ today.isoformat() }}">
          <input type="hidden" name="name" value="{{ q.name }}">
          <input type="hidden" name="calories" value="{{ q.calories }}">
          <input type="hidden" name="protein_g" value="{{ q.protein_g }}">
          <button class="px-3 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 text-sm">{{ q.label }}</button>
        </form>
      {% endfor %}
    </div>

</div>
  </div>

  <div class="mt-6 rounded-2xl bg-slate-900 border border-slate-800 p-4">
    <div class="flex items-center justify-between">
      <div>
        <div class="text-sm text-slate-400">Recent meals (today)</div>
        <div class="text-lg font-semibold">Meals</div>
      </div>
      <a class="text-sm text-slate-300 hover:text-white" href="{{ url_for('day_view', dstr=today.isoformat()) }}">Manage →</a>
    </div>
    <div class="mt-3 grid md:grid-cols-2 gap-2">
      {% for m in meals[:6] %}
        <div class="rounded-xl bg-slate-950 border border-slate-800 p-3 text-sm">
          <div class="flex items-center justify-between">
            <div class="font-medium">{{ m.name }}</div>
            <div class="text-slate-400">{{ m.time or "" }}</div>
          </div>
          <div class="text-slate-400">{{ m.calories or "—" }} cals • {{ m.protein_g or "—" }}g protein</div>
        </div>
      {% else %}
        <div class="text-slate-400 text-sm">No meals logged yet today.</div>
      {% endfor %}
    </div>
  </div>

<script>
const labels = {{ labels|tojson }};
const weights = {{ weights|tojson }};
const goal = {{ goal_weights|tojson }};
const compliance = {{ compliance|tojson }};

new Chart(document.getElementById('wchart'), {
  type: 'line',
  data: {
    labels,
    datasets: [
      { label: 'Weight', data: weights, tension: 0.25 },
      { label: 'Goal line', data: goal, tension: 0.1 }
    ]
  },
  options: {
    responsive: true,
    plugins: { legend: { labels: { color: '#cbd5e1' } } },
    scales: {
      x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.15)' } },
      y: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.15)' } }
    }
  }
});

new Chart(document.getElementById('cchart'), {
  type: 'bar',
  data: { labels, datasets: [{ label: 'Score', data: compliance }] },
  options: {
    responsive: true,
    plugins: { legend: { labels: { color: '#cbd5e1' } } },
    scales: {
      x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.15)' } },
      y: { beginAtZero: true, max: 5, ticks: { color: '#94a3b8' }, grid: { color: 'rgba(148,163,184,0.15)' } }
    }
  }
});
</script>
{% endblock %}
